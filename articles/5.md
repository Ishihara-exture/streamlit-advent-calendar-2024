# 5日目

## 次のアプリにステップアップ！ :streamlit:

こんにちは！最初のアプリはどうでしたか？
今回からはデータを可視化するアプリを作って、サンタさんの「プレゼント配送計画データ」のデータ分析をやってみましょう！  

PythonではPandasというライブラリを使うことでデータの集計や加工を驚くほど簡単にできます。でも、その結果をかっこよく見せるとなると…なんだか難しそうですよね。  
そこでStreamlit！たった数行のコードでデータを可視化してインタラクティブなダッシュボードを作ることができます。グラフやチャートもさくっと表示できるんです！  

今回のアプリも最初のアプリと同様に[Streamlit Playground](https://streamlit.io/playground?example=blank)で試していきましょう！  

![Day1 Streamlit Playground](app/static/day1_streamlit_playground.png "Streamlit Playground")

また、サンタさんの「プレゼント配送計画データ」はCSVファイルで配布されています。  
以下のボタンからダウンロードしておきましょう。  

!!<download>{プレゼント配送計画データをダウンロードする}{static/work2_delivery_plan.csv}{work2_delivery_plan.csv}{text/csv}

なお、このCSVファイルはUTF-8という文字コードで書かれているため、WindowsのExcelで開くと文字化けして見えることがあります。ご注意ください。  

## データ分析、最初の一歩

今回のアプリは5日間に分けてちょっとづつ完成させていきましょう。  
1回目の今回はまず、以下のようなソースコードを入力してみてください！  

```py:work2.py
import streamlit as st
import pandas as pd

st.title("プレゼント配送計画 🦌")

# ファイルをアップロードする
uploaded_file = st.file_uploader("CSVファイルをアップロードしてください", type=["csv"])
if uploaded_file is None:
    st.write("ファイルがアップロードされていません")
    st.stop()

# アップロードされたファイルを読み込む
data = pd.read_csv(uploaded_file)

# データの中身を表示する
st.dataframe(data)
```

ソースコードを入力したら、先ほどダウンロードした「プレゼント配送計画データ」をアップロードしてみたり、手元にあるCSVファイルをアップロードしてみたりしてみてください。  
以下の画像のような表が表示されたら成功です！  

![Day5 実行例](app/static/day5_result.png "CSVファイルが表示された！")

## Pandasとは？

PandasはPythonでデータ分析を行うための超強力なライブラリです。現在ではデータサイエンティストやエンジニアの必須ツールの一つと言っても過言ではありません。  
特徴はデータフレーム(DataFrame)と呼ばれる、Excelのように表形式でデータを扱えることです。  
このデータフレームに対して集計、加工、統計などを行うための機能が豊富に用意されています。  
Pandasは様々なところで活用することができます。例えば…  

- CSVファイルやExcelファイルのデータを使った集計を自動化する
- 時系列データを分析する
- 機械学習のためにデータを綺麗にする

このPandasにStreamlitを組み合わせることで、データフレームや集計・統計の結果を簡単に可視化することができます！  

## 解説

今回も先頭の方から順番に解説していきます。  

```py
import streamlit as st
import pandas as pd
```

いつものおまじないです。  
StreamlitとPandasというライブラリを使うよ、と宣言しています。  

```py
st.title("プレゼント配送計画 🦌")
```

1日目でも解説した```st.title```という関数でタイトルを表示できます。  

```py
# ファイルをアップロードする
uploaded_file = st.file_uploader("CSVファイルをアップロードしてください", type=["csv"])
```

ファイルをアップロードできるようにするには、```st.file_uploader```という関数を使います。  
```type```を指定してあげればアップロードできるファイルの種類を絞ることができます。今回はCSVファイルをアップロードできるようにしたいので、```"csv"```を指定しましょう。こうすると```.csv```で終わるファイル名だけがアップロードできるようになります。  
色々な種類のファイルをアップロードできるようにしたい、というときは例えば```type=["png", "jpg"]```のようにファイルの種類を並べて書きます。  

```py
if uploaded_file is None:
    st.write("ファイルがアップロードされていません")
    st.stop()
```

ファイルがアップロードされていないときは```st.file_uploader```から返ってくる値が```None```になります。  
今回のアプリはファイルがアップロードされるまではやることがありません。こういうときは```st.stop```という関数を呼ぶことで、これ以降の処理をすべてストップさせることができます。  

```py
# アップロードされたファイルを読み込む
data = pd.read_csv(uploaded_file)
```

ファイルがアップロードされると```st.file_uploader```はそのファイルを値として返してくれます。今回は```uploaded_file```という変数で受け取りました。  
この受け取ったものは実際にはCSVファイルになっています。Pandasでは```pd.read_csv```という関数を使うと、CSVファイルを読み込んで、集計や加工をするためのデータフレームを作ってくれます。  
さて、このデータフレーム、実際にはどんなデータが入っているんでしょうか？それを確認するためのソースコードが最後の行です。  

```py
# データの中身を表示する
st.dataframe(data)
```

```st.dataframe```という関数を呼び出すことで、Excelのように表形式でデータを表示してくれます。  
この```st.dataframe```はデータの集計や加工が想像通りに動いているかを確認するために頻繁に呼び出す関数なので、ぜひ覚えておきましょう！  

## 次回予告

6日目はCSVファイルに並んだたくさんのデータから、必要なデータをインタラクティブに絞り込めるようにアプリを改良していきます！  
データ分析らしくなってくるので、お楽しみに！  
